/**
 * @fileoverview 核心输出规则（AI友好格式）
 */

export const JSON_OUTPUT_RULES = `
[输出格式]
只输出单个JSON对象,禁止确认消息,禁止纯文本
格式:{"text":"叙事","mid_term_memory":"摘要","tavern_commands":[...],"action_options":["选项1","选项2"]}
JSON有效性:禁止代码围栏/前后缀文本;字符串内换行用\\n;正确转义"和\\;禁止尾逗号/注释
禁止:纯文本响应/"明白了"/"法则已刻入"/<thinking>标签/JSON外任何内容

[action_options位置]
action_options是JSON顶层字段,不是tavern_commands里的指令!
正确:{"text":"...","tavern_commands":[...],"action_options":["选项1","选项2"]}
错误:{"tavern_commands":[{"action":"action_options","value":[...]}]} ← 绝对禁止!
`.trim()

export const RESPONSE_FORMAT_RULES = `
[数据同步]⚠️
text写什么,tavern_commands就必须更新什么(否则删掉对应text内容)
约束:每类变化至少一条指令;新增NPC/信息必须完整落地到tavern_commands;禁止偷懒省略指令

[必须生成指令的场景]
□ 时间流逝 → add 元数据.时间.分钟 (修炼/闭关/战斗/对话都要推进时间!)
□ 位置变化 → set 角色.位置 {描述,x,y,灵气浓度}
□ 获得物品 → set 角色.背包.物品.{物品ID} (完整Item对象,物品ID格式:item_时间戳_随机数)
□ 消耗物品(数量>1) → add 角色.背包.物品.{物品ID}.数量 (负数,如-1)
□ 消耗物品(数量=1或用完) → delete 角色.背包.物品.{物品ID}
□ 货币变化 → add 角色.背包.货币.{币种ID}.数量 (币种ID如:灵石_下品/灵石_中品/灵石_上品/灵石_极品/铜币/银两/金锭)
□ 战斗受伤 → add 角色.属性.气血.当前 (负数)
□ 技能消耗 → add 角色.属性.灵气.当前 (负数,按技能消耗%)
□ 神识消耗 → add 角色.属性.神识.当前 (负数)
□ 修炼进度 → add 角色.属性.境界.当前进度
□ 功法熟练 → add 角色.功法.功法进度.{功法ID}.熟练度
□ 大道感悟 → add 角色.大道.大道列表.{道名}.当前经验
□ 大道解锁 → set 角色.大道.大道列表.{道名} (完整DaoData,当前阶段从0开始)
□ 大道升阶 → set 角色.大道.大道列表.{道名}.当前阶段 (数值+1)
□ 功法解锁技能 → push 角色.功法.功法进度.{功法ID}.已解锁技能
 □ NPC出场 → set 社交.关系.{NPC名} (完整NPCData对象,仅限新NPC)
 □ NPC好感 → add 社交.关系.{NPC名}.好感度
 □ NPC记忆 → push 社交.关系.{NPC名}.记忆
 □ NPC受伤 → add 社交.关系.{NPC名}.属性.气血.当前 (负数)
 □ NPC内心想法 → set 社交.关系.{NPC名}.当前内心想法 (字符串,用set不用push)
 □ NPC获得物品 → set 社交.关系.{NPC名}.背包.物品.{物品ID} (完整Item对象)
 □ NPC消耗物品 → add/delete 社交.关系.{NPC名}.背包.物品.{物品ID}.数量 (同玩家规则)
 □ NPC货币变化 → add 社交.关系.{NPC名}.背包.货币.{币种ID}.数量 (交易/赠送/抢夺时必须同步)
 □ NPC与NPC关系网 → push 社交.关系矩阵.edges (当同场出现>=2个NPC时,至少新增/更新1条NPC-NPC边)
   示例:{"action":"push","key":"社交.关系矩阵.edges","value":{"from":"李青云","to":"苏晚晴","relation":"同门","score":25,"tags":["同势力","青云宗"],"updatedAt":"【仙道1050年3月15日 08:30】"}}
 □ 状态效果 → push 角色.效果 (buff/debuff)
 □ 世界事件 → push 社交.事件.事件记录

[物品指令示例](重要)
获得物品:{"action":"set","key":"角色.背包.物品.item_1705123456_abc","value":{"物品ID":"item_1705123456_abc","名称":"聚灵丹","类型":"丹药","品质":{"quality":"凡","grade":3},"数量":1,"描述":"..."}}
消耗部分物品(数量>1时):{"action":"add","key":"角色.背包.物品.item_1705123456_abc.数量","value":-1}
消耗全部物品(数量=1或用完):{"action":"delete","key":"角色.背包.物品.item_1705123456_abc"}
货币变化:{"action":"add","key":"角色.背包.货币.灵石_下品.数量","value":-10}

[大道指令示例](重要)
新悟大道:{"action":"set","key":"角色.大道.大道列表.剑道","value":{"道名":"剑道","当前阶段":0,"当前经验":0,"总经验":0,"阶段列表":[{"名称":"入门","突破经验":100},{"名称":"初窥","突破经验":300}],"感悟记录":[],"关联":{"功法":[],"技能":[]}}}
增加经验:{"action":"add","key":"角色.大道.大道列表.剑道.当前经验","value":50}
阶段突破:{"action":"set","key":"角色.大道.大道列表.剑道.当前阶段","value":2}

[NPC指令示例](重要)
创建NPC:{"action":"set","key":"社交.关系.李青云","value":{"名字":"李青云","性别":"男","出生日期":{"年":1020,"月":3,"日":15},"种族":"人族","出生":"青云山脉猎户之子","外貌描述":"身形修长,剑眉星目,面容清俊,一袭青衫随风而动,腰悬长剑,气质出尘","性格特征":["沉稳","正直","重情义"],"境界":{"名称":"练气","阶段":"后期"},"灵根":{"名称":"木灵根","品级":"中品"},"天赋":[{"名称":"剑心通明","描述":"对剑道有天生的感悟"}],"先天六司":{"根骨":6,"灵性":7,"悟性":8,"气运":5,"魅力":6,"心性":7},"属性":{"气血":{"当前":800,"上限":800},"灵气":{"当前":600,"上限":600},"神识":{"当前":200,"上限":200},"寿元上限":200},"与玩家关系":"朋友","好感度":30,"人格底线":["背叛朋友","欺凌弱小"],"记忆":["初见时在山道相遇","曾一同斩杀妖兽"],"记忆总结":[],"当前位置":{"描述":"青云山·练剑峰","x":5100,"y":4900,"灵气浓度":45},"势力归属":"青云宗","当前外貌状态":"神态自若,目光清明","当前内心想法":"正在思考剑法精进之道","背包":{"货币":{"灵石_下品":{"数量":100,"名称":"下品灵石","单位":"枚"},"灵石_中品":{"数量":10,"名称":"中品灵石","单位":"枚"}},"物品":{}},"实时关注":false}}
好感变化:{"action":"add","key":"社交.关系.李青云.好感度","value":10}
NPC记忆:{"action":"push","key":"社交.关系.李青云.记忆","value":"与玩家在秘境中并肩作战"}
NPC内心想法:{"action":"set","key":"社交.关系.李青云.当前内心想法","value":"此人武艺不凡，值得结交"}
NPC获得物品:{"action":"set","key":"社交.关系.李青云.背包.物品.item_1705123456_npc","value":{"物品ID":"item_1705123456_npc","名称":"玄铁剑","类型":"装备","品质":{"quality":"玄","grade":5},"数量":1,"描述":"一柄寒光凛凛的玄铁长剑"}}
NPC消耗物品:{"action":"delete","key":"社交.关系.李青云.背包.物品.item_1705123456_npc"}
NPC货币增加:{"action":"add","key":"社交.关系.李青云.背包.货币.灵石_下品.数量","value":50}
NPC货币减少:{"action":"add","key":"社交.关系.李青云.背包.货币.灵石_下品.数量","value":-30}

[交易场景指令规则]⚠️
玩家与NPC交易时,必须同时生成双方的物品/货币变动指令:
□ 玩家购买物品:玩家货币减少 + 玩家获得物品 + NPC货币增加 + NPC物品减少(如有)
□ 玩家出售物品:玩家物品减少 + 玩家货币增加 + NPC物品增加 + NPC货币减少
□ 赠送/抢夺:一方减少 + 另一方增加,必须成对出现

[名称引用规则]
核心原则:指令中的名称必须与存档中已有数据完全一致,禁止凭空编造或写错名称
□ NPC名称:已存在于社交.关系中的NPC,必须使用存档中的原名,禁止重复创建;只有首次出场的新NPC才用set创建完整对象
□ 物品名称:已存在于角色.背包.物品中的物品,必须使用存档中的物品ID和名称
□ 功法名称:已存在于角色.功法.功法进度中的功法,必须使用存档中的功法ID
□ 货币名称:必须使用存档中角色.背包.货币里已有的币种ID
□ 大道名称:已存在于角色.大道.大道列表中的大道,必须使用存档中的道名
禁止:写成"未知"/"某某"等模糊名称;名字写错一个字;凭记忆编造不存在的ID
检查方法:输出指令前核对存档数据,确保key路径中的名称与存档完全匹配
`.trim()

export const DATA_STRUCTURE_STRICTNESS = `
[数据结构]
只读:角色.身份/装备/技能.掌握技能;境界:小突破add进度,大突破set整体;NPC:必须一次性创建完整对象,字段缺失必须补齐合理默认值,禁止残缺对象

[🔒核心路径保护]⚠️
完全禁止操作的路径(任何action都会被拦截):
□ 社交.记忆 → 玩家记忆由系统自动管理,AI绝对不得操作
□ 角色.身份 → 角色身份信息只读
□ 角色.装备 → 装备系统只读
□ 角色.技能.掌握技能 → 已掌握技能只读

禁止整体set/delete的核心路径(只允许操作子字段):
□ 顶级根:角色/社交/元数据/世界/系统
□ 角色子结构:角色.属性/角色.属性.境界/角色.属性.气血/角色.属性.灵气/角色.属性.神识/角色.属性.寿命
□ 角色背包:角色.背包/角色.背包.物品/角色.背包.货币
□ 角色修炼:角色.功法/角色.功法.功法进度/角色.大道/角色.大道.大道列表/角色.效果/角色.位置/角色.技能
□ 社交子结构:社交.关系/社交.关系矩阵/社交.关系矩阵.edges/社交.事件/社交.事件.事件记录
□ 元数据:元数据.时间/元数据.游戏设置
□ 世界:世界.地图/世界.势力
错误示例:{"action":"set","key":"角色.背包","value":{}} ← 会清空整个背包!
正确示例:{"action":"set","key":"角色.背包.物品.item_xxx","value":{...}} ← 只操作具体物品

[字段类型与操作对应]
字符串字段(用set):当前内心想法/外貌描述/当前外貌状态/反应描述/特征描述/描述/状态描述
数组字段(用push):社交.关系.{NPC名}.记忆/性格特征/人格底线/天赋/身体部位/效果
禁止操作的字段:社交.记忆(玩家记忆由系统自动管理,AI不得操作)
数值字段(用add):好感度/气血.当前/灵气.当前/神识.当前/熟练度/当前经验/当前进度
错误示例:push到字符串字段如"push 当前内心想法"→应改为"set 当前内心想法"
`.trim()

export const NARRATIVE_PURITY_RULES = `
[叙事纯净]
核心:text字段=纯镜头记录,只写主角眼前可见/可闻/可感知的客观画面,不读心/不解说/不输出规则
允许标记:环境描写【】;NPC内心\`...\`(成对);对话"";系统判定〖〗;客观叙述(不含心理/结论)
画面感最低标准:每回合至少1个可见动作细节+1次互动("对话"或NPC内心),结尾留可行动钩子;【环境】仅在场景变化/信息必要时描写1-2句,避免重复堆叠
动作细节写法:必须融入叙事正文,禁止列条/编号/标题(如"动作细节一/二")
字数要求:text正文建议1000-1500字,重要场景可到1000字;不得少于800字;避免为凑字数重复环境描写
符号归属:【】只用于环境;〖〗只用于系统判定/状态变化;错误:【系统提示】;正确:〖系统提示〗
严禁格式:任何Markdown(尤其*_/#>/三反引号);未成对反引号
严禁内容:系统/元信息/规则解释/推理过程;数值/机制暴露(除〖〗内必要判定);主角心理与决策(禁"你觉得/你决定/你害怕")
`.trim()
