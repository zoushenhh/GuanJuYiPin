/**
 * @fileoverview 官阶品级系统类型定义
 *
 * 【术语映射说明】
 * 旧术语（修仙主题）      ->  新术语（县令主题）
 * ------------------------------------------------
 * Realm (境界)            ->  OfficialRank (官阶品级)
 * Cultivation Level       ->  Merit Grade (政绩等级)
 * Breakthrough            ->  Promotion (晋升)
 * Realm Stage             ->  Rank Tier (品级层级)
 *
 * 【设计理念】
 * - 九品十八级官制体系
 * - 通过政绩积累获得晋升
 * - 不同品级对应不同权限和待遇
 * - 设置特殊的荣誉晋升路径
 */

// ============================================================================
// 官阶品级枚举
// ============================================================================

/**
 * 官阶品级（九品十八级）
 *
 * 中国古代官制从正一品到从九品，共十八个等级
 */
export type OfficialRank =
  | '正一品' | '从一品'
  | '正二品' | '从二品'
  | '正三品' | '从三品'
  | '正四品' | '从四品'
  | '正五品' | '从五品'
  | '正六品' | '从六品'
  | '正七品' | '从七品'
  | '正八品' | '从八品'
  | '正九品' | '从九品';

/**
 * 官阶层级
 */
export type RankTier =
  | '一品'        // 一品大员（宰相、尚书等）
  | '二品'        // 二品官员（总督、巡抚等）
  | '三品'        // 三品官员（布政使、按察使等）
  | '四品'        // 四品官员（道员、知府等）
  | '五品'        // 五品官员（同知、知州等）
  | '六品'        // 六品官员（通判、州同等）
  | '七品'        // 七品官员（县令等）
  | '八品'        // 八品官员（县丞等）
  | '九品';       // 九品官员（主簿等）

// ============================================================================
// 品级详细信息
// ============================================================================

/**
 * 品级详细信息
 */
export interface RankInfo {
  品级: OfficialRank;            // 官阶品级
  层级: RankTier;                // 品级层级
  品序: number;                  // 品级序号 [1-18]，1为正一品

  // 待遇信息
  月俸: number;                  // 月俸（银两）
  仪仗: string[];                // 仪仗规格
  服饰: string;                  // 服饰规格

  // 权限信息
  权限: RankPermissions;         // 品级权限
  管辖范围: string;              // 管辖范围

  // 晋升信息
  晋升所需政绩: number;          // 晋升所需政绩
  晋升所需年限: number;          // 晋升所需年限（年）

  // 对应职位
  对应职位: string[];            // 对应的职位列表

  // 特殊标记
  是否为县令品级: boolean;       // 是否为县令常用品级（正七品）
  是否为虚衔: boolean;           // 是否为虚衔（无实权）
}

/**
 * 品级权限
 */
export interface RankPermissions {
  审案权限: {
    民事最高金额: number;        // 可审理民事案件最高金额
    刑事最高刑罚: string;        // 可判处的最高刑罚
  };
  财政权限: {
    可支配库银上限: number;      // 可支配库银上限
    税收调整幅度: number;        // 税收调整幅度 [%]
  };
  人事权限: {
    可任命下属品级: OfficialRank | null; // 可任命的下属最高品级（null表示无权任命）
    幕僚编制: number;            // 幕僚编制数量
  };
  军事权限: {
    可调兵丁数量: number;        // 可调动的兵丁数量
    捕快编制: number;            // 捕快编制数量
  };
  建设权限: {
    可建设设施类型: string[];    // 可建设的设施类型
    单项建设预算上限: number;    // 单项建设预算上限
  };
}

// ============================================================================
// 晋升系统
// ============================================================================

/**
 * 晋升条件
 */
export interface PromotionRequirement {
  当前品级: OfficialRank;        // 当前品级
  目标品级: OfficialRank;        // 目标品级

  // 基础条件
  最低政绩: number;              // 最低政绩要求
  最低年龄: number;              // 最低年龄要求
  最低任龄: number;              // 最低任职年限（年）

  // 附加条件
  所需推荐?: {
    上级推荐?: boolean;          // 是否需要上级推荐
    推荐人品级?: OfficialRank;   // 推荐人所需品级
    推荐信数量?: number;         // 需要推荐信数量
  };

  特殊条件?: string[];           // 特殊条件列表

  // 考核要求
  考核项目: AssessmentItem[];    // 考核项目列表
  考核合格线: number;           // 考核合格线 [0-100]
}

/**
 * 考核项目
 */
export interface AssessmentItem {
  项目: string;                  // 考核项目名称
  权重: number;                  // 考核权重 [0-1]
  评分标准: string;              // 评分标准描述
  数据来源: string;              // 数据来源（如："民心值"、"政绩值"）
}

/**
 * 晋升结果
 */
export interface PromotionResult {
  是否成功: boolean;             // 是否晋升成功
  原品级: OfficialRank;          // 原品级
  新品级?: OfficialRank;         // 新品级
  晋升时间: string;              // 晋升时间
  考核得分: number;              // 考核得分
  各项得分: {
    项目: string;                // 考核项目
    得分: number;                // 项目得分
    权重: number;                // 项目权重
  }[];
  评语: string;                  // 晋升评语
  奖赏?: string;                 // 晋升奖赏
}

// ============================================================================
// 荣誉头衔
// ============================================================================

/**
 * 荣誉头衔类型
 */
export type HonorTitleType =
  | '功勋'        // 功勋头衔
  | '文职'        // 文职头衔
  | '武职'        // 武职头衔
  | '荣誉'        // 荣誉头衔
  | '赐封';       // 皇帝赐封

/**
 * 荣誉头衔
 */
export interface HonorTitle {
  头衔名称: string;              // 头衔名称
  头衔类型: HonorTitleType;      // 头衔类型
  获得时间: string;              // 获得时间
  获得原因: string;              // 获得原因
  效果: TitleEffect;             // 头衔效果
}

/**
 * 头衔效果
 */
export interface TitleEffect {
  威望加成?: number;             // 威望加成
  政绩加成?: number;             // 政绩获取加成
  民心加成?: number;             // 民心加成
  库银加成?: number;             // 库银加成
  特殊权限?: string[];           // 特殊权限
  免责特权?: string[];           // 免责特权
}

// ============================================================================
// 降职与罢免
// ============================================================================

/**
 * 降职原因
 */
export type DemotionReason =
  | '政绩不彰'    // 政绩不佳
  | '失职渎职'    // 失职渎职
  | '贪赃枉法'    // 贪赃枉法
  | '激起民变'    // 激起民变
  | '考核不通过'  // 考核不合格
  | '弹劾成立'    // 弹劾成立
  | '连坐'        // 连坐
  | '其他';       // 其他原因

/**
 * 罢免原因
 */
export type DismissalReason =
  | '重大过失'    // 重大过失
  | '谋逆'        // 谋逆大罪
  | '贪墨巨额'    // 贪污巨额
  | '激起民变'    // 激起民变致死人命
  | '失守城池'    // 失守城池
  | '其他';       // 其他原因

/**
 * 降职记录
 */
export interface DemotionRecord {
  原品级: OfficialRank;          // 原品级
  新品级: OfficialRank;          // 新品级
  降职时间: string;              // 降职时间
  降职原因: DemotionReason;      // 降职原因
  详细说明: string;              // 详细说明
  处理决定: string;              // 处理决定
}

/**
 * 罢免记录
 */
export interface DismissalRecord {
  原品级: OfficialRank;          // 原品级
  罢免时间: string;              // 罢免时间
  罢免原因: DismissalReason;     // 罢免原因
  详细说明: string;              // 详细说明
  处理决定: string;              // 处理决定
  是否永不录用: boolean;         // 是否永不录用
}

// ============================================================================
// 官阶配置数据
// ============================================================================

/**
 * 各品级配置数据
 */
export const RANK_CONFIG: Record<OfficialRank, RankInfo> = {
  // 九品
  '正九品': {
    品级: '正九品',
    层级: '九品',
    品序: 18,
    月俸: 3,
    仪仗: ['无'],
    服饰: '青袍',
    权限: {
      审案权限: { 民事最高金额: 10, 刑事最高刑罚: '杖责五十' },
      财政权限: { 可支配库银上限: 50, 税收调整幅度: 0.05 },
      人事权限: { 可任命下属品级: '从九品', 幕僚编制: 2 },
      军事权限: { 可调兵丁数量: 0, 捕快编制: 5 },
      建设权限: { 可建设设施类型: ['道路', '水利'], 单项建设预算上限: 100 }
    },
    管辖范围: '县辖区',
    晋升所需政绩: 100,
    晋升所需年限: 3,
    对应职位: ['主簿', '巡检'],
    是否为县令品级: false,
    是否为虚衔: false
  },
  '从九品': {
    品级: '从九品',
    层级: '九品',
    品序: 17,
    月俸: 2,
    仪仗: ['无'],
    服饰: '青袍',
    权限: {
      审案权限: { 民事最高金额: 5, 刑事最高刑罚: '杖责三十' },
      财政权限: { 可支配库银上限: 30, 税收调整幅度: 0.03 },
      人事权限: { 可任命下属品级: null, 幕僚编制: 1 },
      军事权限: { 可调兵丁数量: 0, 捕快编制: 3 },
      建设权限: { 可建设设施类型: ['道路'], 单项建设预算上限: 50 }
    },
    管辖范围: '县辖区',
    晋升所需政绩: 80,
    晋升所需年限: 3,
    对应职位: ['典史', '驿丞'],
    是否为县令品级: false,
    是否为虚衔: false
  },
  // 八品
  '正八品': {
    品级: '正八品',
    层级: '八品',
    品序: 16,
    月俸: 5,
    仪仗: ['伞盖1把'],
    服饰: '青袍',
    权限: {
      审案权限: { 民事最高金额: 30, 刑事最高刑罚: '杖责八十' },
      财政权限: { 可支配库银上限: 150, 税收调整幅度: 0.08 },
      人事权限: { 可任命下属品级: '正九品', 幕僚编制: 4 },
      军事权限: { 可调兵丁数量: 10, 捕快编制: 10 },
      建设权限: { 可建设设施类型: ['道路', '水利', '学堂'], 单项建设预算上限: 300 }
    },
    管辖范围: '县辖区',
    晋升所需政绩: 300,
    晋升所需年限: 4,
    对应职位: ['县丞'],
    是否为县令品级: false,
    是否为虚衔: false
  },
  '从八品': {
    品级: '从八品',
    层级: '八品',
    品序: 15,
    月俸: 4,
    仪仗: ['无'],
    服饰: '青袍',
    权限: {
      审案权限: { 民事最高金额: 20, 刑事最高刑罚: '杖责六十' },
      财政权限: { 可支配库银上限: 100, 税收调整幅度: 0.06 },
      人事权限: { 可任命下属品级: '从九品', 幕僚编制: 3 },
      军事权限: { 可调兵丁数量: 5, 捕快编制: 8 },
      建设权限: { 可建设设施类型: ['道路', '水利'], 单项建设预算上限: 200 }
    },
    管辖范围: '县辖区',
    晋升所需政绩: 250,
    晋升所需年限: 4,
    对应职位: ['县丞副'],
    是否为县令品级: false,
    是否为虚衔: false
  },
  // 七品（县令标准品级）
  '正七品': {
    品级: '正七品',
    层级: '七品',
    品序: 14,
    月俸: 7.5,
    仪仗: ['伞盖1把', '肃静牌2块'],
    服饰: '素金带',
    权限: {
      审案权限: { 民事最高金额: 100, 刑事最高刑罚: '流放三千里' },
      财政权限: { 可支配库银上限: 500, 税收调整幅度: 0.10 },
      人事权限: { 可任命下属品级: '正八品', 幕僚编制: 6 },
      军事权限: { 可调兵丁数量: 30, 捕快编制: 20 },
      建设权限: { 可建设设施类型: ['道路', '水利', '学堂', '医馆', '城墙'], 单项建设预算上限: 1000 }
    },
    管辖范围: '全县',
    晋升所需政绩: 800,
    晋升所需年限: 5,
    对应职位: ['县令', '知县'],
    是否为县令品级: true,
    是否为虚衔: false
  },
  '从七品': {
    品级: '从七品',
    层级: '七品',
    品序: 13,
    月俸: 6,
    仪仗: ['伞盖1把'],
    服饰: '素银带',
    权限: {
      审案权限: { 民事最高金额: 80, 刑事最高刑罚: '徒刑三年' },
      财政权限: { 可支配库银上限: 400, 税收调整幅度: 0.09 },
      人事权限: { 可任命下属品级: '从八品', 幕僚编制: 5 },
      军事权限: { 可调兵丁数量: 20, 捕快编制: 15 },
      建设权限: { 可建设设施类型: ['道路', '水利', '学堂', '医馆'], 单项建设预算上限: 800 }
    },
    管辖范围: '全县',
    晋升所需政绩: 600,
    晋升所需年限: 5,
    对应职位: ['州判', '县令副'],
    是否为县令品级: false,
    是否为虚衔: false
  },
  // 六品
  '正六品': {
    品级: '正六品',
    层级: '六品',
    品序: 12,
    月俸: 10,
    仪仗: ['伞盖1把', '肃静牌4块', '回避牌2块'],
    服饰: '素银带',
    权限: {
      审案权限: { 民事最高金额: 300, 刑事最高刑罚: '绞监候' },
      财政权限: { 可支配库银上限: 1000, 税收调整幅度: 0.12 },
      人事权限: { 可任命下属品级: '正七品', 幕僚编制: 8 },
      军事权限: { 可调兵丁数量: 50, 捕快编制: 30 },
      建设权限: { 可建设设施类型: ['道路', '水利', '学堂', '医馆', '城墙', '桥梁'], 单项建设预算上限: 2000 }
    },
    管辖范围: '州辖县',
    晋升所需政绩: 2000,
    晋升所需年限: 6,
    对应职位: ['通判', '州同'],
    是否为县令品级: false,
    是否为虚衔: false
  },
  '从六品': {
    品级: '从六品',
    层级: '六品',
    品序: 11,
    月俸: 8,
    仪仗: ['伞盖1把', '肃静牌2块'],
    服饰: '素银带',
    权限: {
      审案权限: { 民事最高金额: 200, 刑事最高刑罚: '流放二千里' },
      财政权限: { 可支配库银上限: 800, 税收调整幅度: 0.11 },
      人事权限: { 可任命下属品级: '从七品', 幕僚编制: 7 },
      军事权限: { 可调兵丁数量: 40, 捕快编制: 25 },
      建设权限: { 可建设设施类型: ['道路', '水利', '学堂', '医馆', '城墙'], 单项建设预算上限: 1500 }
    },
    管辖范围: '州辖县',
    晋升所需政绩: 1500,
    晋升所需年限: 6,
    对应职位: ['通判副'],
    是否为县令品级: false,
    是否为虚衔: false
  },
  // 五品
  '正五品': {
    品级: '正五品',
    层级: '五品',
    品序: 10,
    月俸: 15,
    仪仗: ['伞盖2把', '肃静牌4块', '回避牌4块', '青旗4面'],
    服饰: '素金带',
    权限: {
      审案权限: { 民事最高金额: 500, 刑事最高刑罚: '斩监候' },
      财政权限: { 可支配库银上限: 2000, 税收调整幅度: 0.15 },
      人事权限: { 可任命下属品级: '正六品', 幕僚编制: 10 },
      军事权限: { 可调兵丁数量: 100, 捕快编制: 50 },
      建设权限: { 可建设设施类型: ['全部'], 单项建设预算上限: 5000 }
    },
    管辖范围: '府州',
    晋升所需政绩: 5000,
    晋升所需年限: 7,
    对应职位: ['知州', '同知', '直隶州知州'],
    是否为县令品级: false,
    是否为虚衔: false
  },
  '从五品': {
    品级: '从五品',
    层级: '五品',
    品序: 9,
    月俸: 12,
    仪仗: ['伞盖2把', '肃静牌4块', '回避牌2块', '青旗2面'],
    服饰: '素金带',
    权限: {
      审案权限: { 民事最高金额: 400, 刑事最高刑罚: '绞监候' },
      财政权限: { 可支配库银上限: 1500, 税收调整幅度: 0.14 },
      人事权限: { 可任命下属品级: '从六品', 幕僚编制: 9 },
      军事权限: { 可调兵丁数量: 80, 捕快编制: 40 },
      建设权限: { 可建设设施类型: ['道路', '水利', '学堂', '医馆', '城墙', '桥梁', '市场'], 单项建设预算上限: 4000 }
    },
    管辖范围: '府州',
    晋升所需政绩: 4000,
    晋升所需年限: 7,
    对应职位: ['知州副'],
    是否为县令品级: false,
    是否为虚衔: false
  },
  // 四品
  '正四品': {
    品级: '正四品',
    层级: '四品',
    品序: 8,
    月俸: 20,
    仪仗: ['伞盖2把', '肃静牌6块', '回避牌6块', '青旗6面', '铜锣'],
    服饰: '花金带',
    权限: {
      审案权限: { 民事最高金额: 1000, 刑事最高刑罚: '斩立决' },
      财政权限: { 可支配库银上限: 5000, 税收调整幅度: 0.18 },
      人事权限: { 可任命下属品级: '正五品', 幕僚编制: 12 },
      军事权限: { 可调兵丁数量: 200, 捕快编制: 80 },
      建设权限: { 可建设设施类型: ['全部'], 单项建设预算上限: 10000 }
    },
    管辖范围: '府',
    晋升所需政绩: 12000,
    晋升所需年限: 8,
    对应职位: ['知府', '道员'],
    是否为县令品级: false,
    是否为虚衔: false
  },
  '从四品': {
    品级: '从四品',
    层级: '四品',
    品序: 7,
    月俸: 18,
    仪仗: ['伞盖2把', '肃静牌6块', '回避牌4块', '青旗4面'],
    服饰: '花金带',
    权限: {
      审案权限: { 民事最高金额: 800, 刑事最高刑罚: '斩监候' },
      财政权限: { 可支配库银上限: 4000, 税收调整幅度: 0.16 },
      人事权限: { 可任命下属品级: '从五品', 幕僚编制: 11 },
      军事权限: { 可调兵丁数量: 150, 捕快编制: 60 },
      建设权限: { 可建设设施类型: ['全部'], 单项建设预算上限: 8000 }
    },
    管辖范围: '府',
    晋升所需政绩: 10000,
    晋升所需年限: 8,
    对应职位: ['知府副'],
    是否为县令品级: false,
    是否为虚衔: false
  },
  // 三品
  '正三品': {
    品级: '正三品',
    层级: '三品',
    品序: 6,
    月俸: 30,
    仪仗: ['全套仪仗'],
    服饰: '花金带',
    权限: {
      审案权限: { 民事最高金额: 2000, 刑事最高刑罚: '斩立决' },
      财政权限: { 可支配库银上限: 10000, 税收调整幅度: 0.20 },
      人事权限: { 可任命下属品级: '正四品', 幕僚编制: 15 },
      军事权限: { 可调兵丁数量: 500, 捕快编制: 100 },
      建设权限: { 可建设设施类型: ['全部'], 单项建设预算上限: 20000 }
    },
    管辖范围: '省',
    晋升所需政绩: 30000,
    晋升所需年限: 10,
    对应职位: ['布政使', '按察使', '巡抚'],
    是否为县令品级: false,
    是否为虚衔: false
  },
  '从三品': {
    品级: '从三品',
    层级: '三品',
    品序: 5,
    月俸: 25,
    仪仗: ['全套仪仗'],
    服饰: '花金带',
    权限: {
      审案权限: { 民事最高金额: 1500, 刑事最高刑罚: '斩立决' },
      财政权限: { 可支配库银上限: 8000, 税收调整幅度: 0.18 },
      人事权限: { 可任命下属品级: '从四品', 幕僚编制: 14 },
      军事权限: { 可调兵丁数量: 400, 捕快编制: 80 },
      建设权限: { 可建设设施类型: ['全部'], 单项建设预算上限: 15000 }
    },
    管辖范围: '省',
    晋升所需政绩: 25000,
    晋升所需年限: 10,
    对应职位: ['布政使副', '按察使副'],
    是否为县令品级: false,
    是否为虚衔: false
  },
  // 二品
  '正二品': {
    品级: '正二品',
    层级: '二品',
    品序: 4,
    月俸: 50,
    仪仗: ['全套仪仗'],
    服饰: '麒麟补服',
    权限: {
      审案权限: { 民事最高金额: 5000, 刑事最高刑罚: '斩立决' },
      财政权限: { 可支配库银上限: 20000, 税收调整幅度: 0.25 },
      人事权限: { 可任命下属品级: '正三品', 幕僚编制: 20 },
      军事权限: { 可调兵丁数量: 1000, 捕快编制: 200 },
      建设权限: { 可建设设施类型: ['全部'], 单项建设预算上限: 50000 }
    },
    管辖范围: '省/部',
    晋升所需政绩: 80000,
    晋升所需年限: 12,
    对应职位: ['总督', '尚书'],
    是否为县令品级: false,
    是否为虚衔: false
  },
  '从二品': {
    品级: '从二品',
    层级: '二品',
    品序: 3,
    月俸: 40,
    仪仗: ['全套仪仗'],
    服饰: '麒麟补服',
    权限: {
      审案权限: { 民事最高金额: 4000, 刑事最高刑罚: '斩立决' },
      财政权限: { 可支配库银上限: 15000, 税收调整幅度: 0.22 },
      人事权限: { 可任命下属品级: '从三品', 幕僚编制: 18 },
      军事权限: { 可调兵丁数量: 800, 捕快编制: 150 },
      建设权限: { 可建设设施类型: ['全部'], 单项建设预算上限: 40000 }
    },
    管辖范围: '省/部',
    晋升所需政绩: 60000,
    晋升所需年限: 12,
    对应职位: ['总督副', '侍郎'],
    是否为县令品级: false,
    是否为虚衔: false
  },
  // 一品
  '正一品': {
    品级: '正一品',
    层级: '一品',
    品序: 1,
    月俸: 100,
    仪仗: ['御赐仪仗'],
    服饰: '仙鹤补服',
    权限: {
      审案权限: { 民事最高金额: Infinity, 刑事最高刑罚: '无限制' },
      财政权限: { 可支配库银上限: Infinity, 税收调整幅度: 0.30 },
      人事权限: { 可任命下属品级: '正二品', 幕僚编制: 30 },
      军事权限: { 可调兵丁数量: Infinity, 捕快编制: 500 },
      建设权限: { 可建设设施类型: ['全部'], 单项建设预算上限: Infinity }
    },
    管辖范围: '全国',
    晋升所需政绩: Infinity,
    晋升所需年限: Infinity,
    对应职位: ['宰相', '太师', '太傅'],
    是否为县令品级: false,
    是否为虚衔: false
  },
  '从一品': {
    品级: '从一品',
    层级: '一品',
    品序: 2,
    月俸: 80,
    仪仗: ['御赐仪仗'],
    服饰: '麒麟补服',
    权限: {
      审案权限: { 民事最高金额: 10000, 刑事最高刑罚: '无限制' },
      财政权限: { 可支配库银上限: 50000, 税收调整幅度: 0.28 },
      人事权限: { 可任命下属品级: '从二品', 幕僚编制: 25 },
      军事权限: { 可调兵丁数量: 5000, 捕快编制: 300 },
      建设权限: { 可建设设施类型: ['全部'], 单项建设预算上限: 100000 }
    },
    管辖范围: '全国',
    晋升所需政绩: Infinity,
    晋升所需年限: Infinity,
    对应职位: ['少师', '少傅', '少保'],
    是否为县令品级: false,
    是否为虚衔: false
  }
};

// ============================================================================
// 工具函数
// ============================================================================

/**
 * 获取品级序号（越小品级越高）
 */
export function getRankOrder(rank: OfficialRank): number {
  return RANK_CONFIG[rank].品序;
}

/**
 * 比较两个品级的高低
 */
export function compareRanks(rank1: OfficialRank, rank2: OfficialRank): number {
  return getRankOrder(rank1) - getRankOrder(rank2);
}

/**
 * 获取下一品级
 */
export function getNextRank(currentRank: OfficialRank): OfficialRank | null {
  const order = getRankOrder(currentRank);
  if (order === 1) return null; // 已是最高品级
  for (const [rank, config] of Object.entries(RANK_CONFIG)) {
    if (config.品序 === order - 1) {
      return rank as OfficialRank;
    }
  }
  return null;
}

/**
 * 检查是否为县令品级
 */
export function isMagistrateRank(rank: OfficialRank): boolean {
  return RANK_CONFIG[rank].是否为县令品级;
}
