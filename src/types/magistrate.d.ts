/**
 * @fileoverview 县令系统类型定义
 *
 * 【术语映射说明】
 * 旧术语（修仙主题）      ->  新术语（县令主题）
 * ------------------------------------------------
 * Cultivator/Player      ->  Magistrate (县令)
 * SpiritRoot (灵根)       ->  Background (出身背景)
 * root_bone (根骨)        ->  Stamina (精力)
 * mana (灵力)             ->  Authority (威望)
 * lifespan (寿元)         ->  Age/Term (年龄/任期)
 * SpiritStone             ->  Silver/Budget (库银)
 * Cultivation (修为)      ->  Merit (政绩)
 * Realm (境界)            ->  OfficialRank (官阶品级)
 * Sect (宗门)             ->  Government (衙门)
 *
 * 【设计理念】
 * - 县令是玩家扮演的核心角色
 * - 通过政绩积累获得晋升
 * - 威望影响治理能力和民众支持
 * - 精力限制每日行动次数
 * - 年龄和任期影响游戏进程
 */

import type { ValuePair, InnateAttributes, GameTime, AIMetadata } from './game';

// ============================================================================
// 核心类型定义
// ============================================================================

/**
 * 县令主体数据结构
 *
 * 替代旧的 Character/Cultivator 类型
 */
export interface Magistrate extends AIMetadata {
  // === 身份信息 ===
  id: string;                    // 县令唯一标识
  姓名: string;                  // 县令姓名
  字?: string;                   // 表字
  号?: string;                   // 别号

  // === 年龄与任期 ===
  年龄: number;                  // 实际年龄
  就任年龄: number;              // 就任时的年龄
  任期: ValuePair<number>;       // 当前任期（年）及上限限制
  寿命: ValuePair<number>;       // 预期寿命（年）

  // === 出身背景（对应原灵根系统）===
  出身: MagistrateBackground;    // 出身背景
  籍贯: string;                  // 籍贯（如："江南苏州府"）

  // === 官阶品级 ===
  官品: OfficialRank;            // 当前官阶品级
  官职: string;                  // 具体官职（如："清河县令"）
  履历: OfficialRecord[];        // 任职履历

  // === 核心属性 ===
  // 精力（对应原根骨）
  精力: ValuePair<number>;       // 精力值 [0-100]，影响行动能力

  // 威望（对应原灵力/法力）
  威望: ValuePair<number>;       // 威望值 [0-10000]，影响治理效果

  // 政绩（对应原修为）
  政绩: MeritRecord;             // 政绩记录与积累

  // 健康（对应原气血）
  健康: ValuePair<number>;       // 健康值 [0-100]

  // 心境（对应原神识）
  心境: ValuePair<number>;       // 心境值 [0-100]，影响决策能力

  // === 先天六司（继承自原系统）===
  先天六司: InnateAttributes;    // 根骨、灵性、悟性、气运、魅力、心性

  // === 财政资源 ===
  俸禄: number;                   // 月俸（银两）
  私财: number;                   // 私人财产（银两）

  // === 治理能力 ===
  治理能力: GovernanceAbility;   // 各项治理能力评分

  // === 状态标记 ===
  状态: MagistrateStatus;         // 当前状态
  状态效果: StatusEffect[];       // 当前状态效果列表

  // === 成就与声望 ===
  头衔: string[];                 // 获得的头衔
  声望: ValuePair<number>;        // 声望值 [0-10000]

  // === 关系网络 ===
  人脉: Relationship[];           // 人脉关系

  // === 时间戳 ===
  创建时间: string;               // 创建时间（现实时间）
  更新时间: string;               // 最后更新时间

  // === 扩展字段 ===
  扩展?: {
    [key: string]: any;
  };
}

/**
 * 县令出身背景类型（对应原灵根系统）
 */
export type MagistrateBackground =
  | '寒门士子'    // 出身寒门，科举入仕
  | '世家子弟'    // 出身名门世家
  | '武将世家'    // 出身武将家庭
  | '商贾之子'    // 出身商贾家庭
  | '农民子弟'    // 出身农民家庭
  | '皇亲国戚'    // 皇室亲属
  | '官宦之后'    // 官员后代
  | '江湖游侠'    // 江湖出身
  | '寺庙出身'    // 寺庙出家
  | '其他';       // 其他出身

/**
 * 县令状态
 */
export type MagistrateStatus =
  | '在任'        // 正常任职
  | '出差'        // 外出办事
  | '病休'        // 因病休假
  | '丁忧'        // 守孝期间
  | '被弹劾'      // 被弹劾停职
  | '升迁'        // 等待升迁
  | '调任'        // 等待调任
  | '退休';       // 已退休

/**
 * 状态效果
 */
export interface StatusEffect {
  id: string;                    // 效果唯一标识
  名称: string;                  // 效果名称
  描述: string;                  // 效果描述
  类型: StatusEffectType;        // 效果类型
  剩余时间: number;              // 剩余时间（回合数）
  加成: {
    精力加成?: number;           // 精力加成
    威望加成?: number;           // 威望加成
    健康加成?: number;           // 健康加成
    心境加成?: number;           // 心境加成
    政绩加成?: number;           // 政绩获取加成
    治理能力加成?: Partial<GovernanceAbility>; // 治理能力加成
  };
}

/**
 * 状态效果类型
 */
export type StatusEffectType =
  | '正面'        // 正面效果
  | '负面'        // 负面效果
  | '中性';       // 中性效果

// ============================================================================
// 政绩系统
// ============================================================================

/**
 * 政绩记录（对应原修为系统）
 */
export interface MeritRecord {
  当前政绩: number;              // 当前政绩值
  政绩等级: MeritGrade;          // 政绩等级
  晋升所需: number;              // 晋升下一级所需政绩
  政绩历史: MeritEntry[];        // 政绩获得历史
}

/**
 * 政绩等级（对应原境界等级）
 */
export type MeritGrade =
  | '无品'        // 无品级，初入仕途
  | '从九品'      // 最低品级
  | '正九品'
  | '从八品'
  | '正八品'
  | '从七品'
  | '正七品'      // 县令标准品级
  | '从六品'
  | '正六品'
  | '从五品'
  | '正五品'
  | '从四品'
  | '正四品'
  | '从三品'
  | '正三品'
  | '从二品'
  | '正二品'
  | '从一品'
  | '正一品';     // 最高品级

/**
 * 政绩条目
 */
export interface MeritEntry {
  时间: GameTime;                // 获得时间
  来源: MeritSource;             // 政绩来源
  数量: number;                  // 获得政绩值
  描述: string;                  // 详细描述
}

/**
 * 政绩来源
 */
export type MeritSource =
  | '审理案件'    // 通过审理案件获得
  | '平息民变'    // 平息民变
  | '征收税款'    // 完成税收任务
  | '兴修水利'    // 基础设施建设
  | '赈灾救济'    // 赈灾救民
  | '教化百姓'    // 兴办学堂
  | '破获大案'    // 破获重大案件
  | '上级表彰'    // 获得上级表彰
  | '民众拥戴'    // 民众支持
  | '其他';       // 其他来源

// ============================================================================
// 治理能力
// ============================================================================

/**
 * 治理能力评分
 */
export interface GovernanceAbility {
  断案能力: number;              // 断案能力 [0-100]
  治安能力: number;              // 治安能力 [0-100]
  经济能力: number;              // 经济能力 [0-100]
  教化能力: number;              // 教化能力 [0-100]
  建设能力: number;              // 建设能力 [0-100]
  外交能力: number;              // 外交能力 [0-100]
}

// ============================================================================
// 任职记录
// ============================================================================

/**
 * 任职记录
 */
export interface OfficialRecord {
  官职: string;                  // 担任官职
  品级: OfficialRank;            // 官阶品级
  就任时间: GameTime;            // 就任时间
  离任时间?: GameTime;           // 离任时间（可选）
  任期时长?: number;             // 任期长度（月数）
  治理成果?: string[];           // 主要治理成果
  离任原因?: string;             // 离任原因
}

/**
 * 官阶品级
 */
export type OfficialRank =
  | '从九品' | '正九品'
  | '从八品' | '正八品'
  | '从七品' | '正七品'
  | '从六品' | '正六品'
  | '从五品' | '正五品'
  | '从四品' | '正四品'
  | '从三品' | '正三品'
  | '从二品' | '正二品'
  | '从一品' | '正一品';

// ============================================================================
// 关系网络
// ============================================================================

/**
 * 人脉关系
 */
export interface Relationship {
  对象姓名: string;              // 关系对象姓名
  关系类型: RelationshipType;    // 关系类型
  好感度: number;                // 好感度 [0-100]
  认识时间: GameTime;            // 认识时间
  最近互动?: GameTime;           // 最近互动时间
  备注?: string;                 // 备注信息
}

/**
 * 关系类型
 */
export type RelationshipType =
  | '上级'        // 上级官员
  | '同僚'        // 同级官员
  | '下属'        // 下属官员
  | '亲友'        // 亲戚朋友
  | '师友'        // 师长朋友
  | '商贾'        // 商贾关系
  | '士绅'        // 本地士绅
  | '江湖'        // 江湖人士
  | '其他';       // 其他关系
