/**
 * @fileoverview 幕僚下属系统类型定义（县令特色功能）
 *
 * 【术语说明】
 * - 幕僚：县令的下属和助手
 * - 衙门：县衙内的各个职位
 * - 才能：幕僚的专长技能
 * - 派系：幕僚所属的政治派系
 *
 * 【设计理念】
 * - 替代修仙主题的"宗门弟子"系统
 * - 幕僚提供各种政务加成和能力
 * - 通过招募和管理幕僚提升县令的治理能力
 */

import type { NpcProfile, InnateAttributes, Item, GameTime } from './game';

// ============================================================================
// 职位类型定义
// ============================================================================

/**
 * 幕僚职位（县令主题）
 */
export type StaffPosition =
  | '县丞'      // 副县令，协助处理日常政务
  | '主簿'      // 负责文书、档案、财政
  | '典史'      // 负责治安、捕快、监狱
  | '捕头'      // 带领捕快办案
  | '师爷'      // 幕僚长，出谋划策
  | '书吏'      // 一般文书人员
  | '衙役'      // 基层执法人员
  | '账房'      // 财务人员
  | '仵作'      // 验尸人员
  | '其他';     // 其他职位

/**
 * 职位等级
 */
export type StaffRank =
  | '正九品'    // 最低级官员
  | '从八品'
  | '正八品'
  | '从七品'
  | '正七品'
  | '从六品'
  | '正六品'
  | '从五品'
  | '正五品';   // 最高级幕僚

// ============================================================================
// 才能类型定义
// ============================================================================

/**
 * 幕僚专长类型
 */
export type StaffSpecialty =
  | '刑名'      // 擅长审案、断案
  | '钱谷'      // 擅长财政、税收
  | '营造'      // 擅长工程建设
  | '文案'      // 擅长文书起草
  | '外交'      // 擅长对外交涉
  | '武备'      // 擅长武艺、捕盗
  | '医疗'      // 擅长医术
  | '教学'      // 擅长教导
  | '杂务'      // 处理杂务
  | '全能';     // 多项技能

/**
 * 才能等级
 */
export type SpecialtyLevel = '入门' | '熟练' | '精通' | '专家' | '宗师';

/**
 * 幕僚才能数据
 */
export interface StaffSpecialty {
  类型: StaffSpecialty;         // 专长类型
  等级: SpecialtyLevel;        // 专长等级
  经验: number;                 // 专长经验 [0-1000]
  加成: {
        效率加成?: number;      // 效率加成 [0-50%]
        成功率加成?: number;   // 成功率加成 [0-30%]
        特殊能力?: string[];   // 特殊能力列表
      };
}

// ============================================================================
// 派系系统
// ============================================================================

/**
 * 政治派系
 */
export type StaffFaction =
  | '本地士绅'    // 本地土著势力
  | '朝廷流官'    // 朝廷派来的官员
  | '寒门'        // 出身寒门
  | '世家'        // 出身名门
  | '商贾'        // 商人背景
  | '武官'        // 武官背景
  | '中立';       // 不偏向任何派系

/**
 * 派系关系
 */
export interface FactionRelation {
  派系: StaffFaction;            // 对方派系
  关系: '敌对' | '冷淡' | '中立' | '友好' | '同盟';
  影响力: number;               // 关系影响力 [0-100]
}

// ============================================================================
// 核心类型定义
// ============================================================================

/**
 * 幕僚数据结构（扩展自 NPC）
 */
export interface StaffMember extends NpcProfile {
  // === 职位信息 ===
  职位: StaffPosition;           // 当前职位
  品级: StaffRank;               // 官品等级
  任命时间?: GameTime;           // 任命时间
  任期?: number;                 // 任期（月数），0表示无限期

  // === 才能系统 ===
  专长: StaffSpecialty[];        // 专长列表（最多3个）
  主修专长: StaffSpecialty;      // 主修专长（最强的一项）

  // === 忠诚度系统 ===
  忠诚度: number;                // 忠诚度 [0-100]
  忠诚度变化记录: {
        时间: GameTime;
        变化: number;            // 忠诚度变化值
        原因: string;            // 变化原因
      }[];

  // === 薪俸系统 ===
  月俸: number;                  // 月俸（银两）
  上次发放时间?: GameTime;       // 上次发放俸禄时间

  // === 工作状态 ===
  当前状态: '在岗' | '出差' | '病休' | '被罢免' | '离职';
  工作效率: number;              // 当前工作效率 [0-100]
  疲劳度: number;                // 疲劳度 [0-100]，过高需要休息

  // === 派系关系 ===
  派系: StaffFaction;             // 所属派系
  派系关系: FactionRelation[];  // 与各派系的关系

  // === 能力加成（对县令的加成）===
  加成: {
    断案加成?: number;           // 断案能力加成 [0-20]
    税收加成?: number;           // 税收能力加成 [0-20%]
    建设加成?: number;           // 建设能力加成 [0-20%]
    治安加成?: number;           // 治安能力加成 [0-20]
    民心加成?: number;           // 民心能力加成 [0-20]
    威望加成?: number;           // 威望能力加成 [0-10]
  };

  // === 装备物品 ===
  装备物品?: string[];           // 携带的物品ID列表

  // === 扩展字段 ===
  扩展?: {
    [key: string]: any;
  };
}

// ============================================================================
// 幕僚招募系统
// ============================================================================

/**
 * 招募渠道
 */
export type RecruitmentChannel =
  | '科举'      // 通过科举选拔
  | '推荐'      // 由他人推荐
  | '招募'      // 公开招募
  | '调任'      // 上级调任
  | '投奔'      // 主动投奔
  | '其他';     // 其他方式

/**
 * 招募条件
 */
export interface RecruitmentRequirement {
  最低官品?: StaffRank;         // 需要的最低官品
  最低声望?: number;            // 需要的最低声望
  最低民心?: number;            // 需要的最低民心
  最低库银?: number;            // 需要的最低库银
  特殊条件?: string;            // 特殊条件描述

  // 人才要求
  才能要求?: {
    类型: StaffSpecialty;
    最低等级: SpecialtyLevel;
  }[];
}

/**
 * 幕僚候选人
 */
export interface StaffCandidate {
  id: string;                    // 候选人ID

  // 基本信息
  姓名: string;
  性别: '男' | '女';
  年龄: number;
  出身: string;                 // 出身背景

  // 能力信息
  申请职位: StaffPosition;      // 申请的职位
  专长: StaffSpecialty[];        // 专长列表
  综合能力: number;              // 综合能力评分 [0-100]

  // 期望条件
  期望月俸: number;              // 期望的月薪
  特殊要求?: string;            // 特殊要求

  // 招募信息
  招募渠道: RecruitmentChannel;  // 招募渠道
  推荐人?: string;               // 推荐人姓名
  推荐信?: string;               // 推荐信内容

  // 状态
  状态: '待审' | '已录用' | '已拒绝' | '已过期';
  审核记录?: {
    时间: GameTime;
    结果: '录用' | '拒绝';
    理由?: string;
  }[];

  // 完整NPC数据（录用后使用）
  完整数据?: Omit<StaffMember, '职位' | '品级'>;
}

// ============================================================================
// 幕僚任务系统
// ============================================================================

/**
 * 任务类型
 */
export type StaffTaskType =
  | '审案'      // 审理案件
  | '征税'      // 征收税款
  | '建设'      // 监督建设
  | '巡查'      // 巡视辖区
  | '文书'      // 处理文书
  | '外交'      // 外交事务
  | '训练'      // 训练士兵
  | '其他';     // 其他任务

/**
 * 幕僚任务
 */
export interface StaffTask {
  id: string;                    // 任务ID
  类型: StaffTaskType;          // 任务类型
  名称: string;                  // 任务名称
  描述: string;                  // 任务描述

  // 分配信息
  分配给: string;               // 分配给的幕僚姓名
  分配时间: GameTime;           // 分配时间

  // 任务要求
  难度: number;                 // 任务难度 [1-10]
  预计时间: number;             // 预计完成时间（回合数）
  实际用时?: number;            // 实际用时（回合数）

  // 任务状态
  状态: '进行中' | '已完成' | '已失败' | '已取消';
  进度: number;                 // 任务进度 [0-100]

  // 任务结果
  结果?: {
    成功: boolean;
    评分: number;               // 任务完成评分 [0-100]
    奖励?: string;             // 完成奖励描述
    惩罚?: string;             // 失败惩罚描述
  };

  // 任务影响
  影响?: {
    幕僚经验?: number;          // 幕僚获得的经验
    忠诚度变化?: number;       // 忠诚度变化
    疲劳度变化?: number;       // 疲劳度变化
  };
}

// ============================================================================
// 导出类型集合
// ============================================================================

export type {
  // 核心类型
  StaffMember,
  StaffCandidate,
  StaffTask,

  // 类型枚举
  StaffPosition,
  StaffRank,
  StaffSpecialty,
  SpecialtyLevel,
  StaffFaction,
  StaffTaskType,
  RecruitmentChannel,

  // 接口类型
  FactionRelation,
  RecruitmentRequirement,
};
