import type { GameTime, NpcProfile, WorldInfo } from '@/types/game';

export type SpecialNpcSceneTag =
  | 'earth'
  | 'xianxia'
  | 'modern'
  | 'campus'
  | 'city'
  | 'sect'
  | 'jianghu';

export type SpecialNpcDefinition = {
  /** 稳定ID（用于存档标记/去重/后续扩展） */
  id: string;
  /** 用于候选列表展示（不一定等于最终 NPC 名字，但建议一致） */
  displayName: string;
  /** 场景标签：用于筛选"更适合当前世界/地点"的NPC */
  sceneTags: SpecialNpcSceneTag[];
  /** 人设提示词：用于让AI写出更贴合的登场事件（不会直接注入正文，避免污染） */
  personaPrompt: string;
  /** 创建NPC档案（可根据当前时间/地点做轻度适配） */
  createProfile: (ctx: { now: GameTime; playerLocationDesc?: string; worldInfo?: WorldInfo | null }) => NpcProfile;
};

export const SPECIAL_NPCS: SpecialNpcDefinition[] = [
  {
    id: 'magistrate_administrative_assistant_cailian',
    displayName: '彩莲',
    sceneTags: ['earth', 'city', 'sect'],
    personaPrompt: `【人设】彩莲：县衙新任幕僚/19岁男性（绝色）/七品初期官职/治理才能（极品）持有者。
【外貌】黑色束发，戴简洁玉冠，身着淡青色官袍，腰系青玉带。雌雄莫辨的绝色容貌，气质温润如玉，言行得体大方。
【才能】天生的行政奇才，精通文书起草、账目核算、民情安抚。擅长从复杂政务中理清脉络，能将混乱的县政治理得井井有条。具备卓越的调解能力和说服力。
【性格】友善且守序，表面是普通幕僚，实则是官场罕见的行政天才。行事谨慎，恪尽职守，关心百姓疾苦。
【互动机制】可通过提升好感度解锁合作功能，合作可提升玩家政绩但不宜频繁；合作后获得"精力消耗"debuff，同时获得"政务助力"buff加速后续治理。
【禁忌】不要写成主动勾引或轻浮角色，保持友善守序的清廉官吏人设；避免权力斗争场景。`.trim(),
    createProfile: ({ now, playerLocationDesc }): NpcProfile => ({
      名字: '彩莲',
      性别: '男',
      出生日期: { 年: Number(now.年 ?? 0) - 19, 月: 3, 日: 15 },
      种族: '人族',
      出生: '书香门第',
      外貌描述: '黑色长发束于玉冠之中，面容雌雄莫辨，气质温润如玉。身着淡青色七品官袍，腰系青玉带，举止得体，言谈文雅。',
      性格特征: ['友善', '守序', '勤勉', '清廉'],
      境界: {
        名称: '七品',
        阶段: '初期',
        当前进度: 0,
        下一级所需: 50000,
        突破描述: '积累政绩，升迁六品',
      } as any,
      // 县令主题字段（与境界字段保持同步）
      官品: {
        名称: '七品',
        阶段: '初期',
        当前进度: 0,
        下一级所需: 50000,
        晋升描述: '积累政绩，升迁六品',
      } as any,
      灵根: {
        name: '治理才能',
        tier: '极品',
        描述: '天生的行政奇才，精通文书起草、账目核算、民情安抚。虽年轻，却因过人的洞察力和组织能力，被誉为县衙"小小神算子"。极擅长调解纠纷，能化干戈为玉帛。',
      } as any,
      // 县令主题字段（与灵根字段保持同步）
      才能: {
        name: '治理才能',
        tier: '极品',
        描述: '天生的行政奇才，精通文书起草、账目核算、民情安抚。虽年轻，却因过人的洞察力和组织能力，被誉为县衙"小小神算子"。极擅长调解纠纷，能化干戈为玉帛。',
      } as any,
      天赋: [
        { name: '明察秋毫', description: '天生的洞察力，能从细微处发现问题的关键，迅速理清政务脉络。' },
        { name: '温润如玉', description: '言行举止皆显教养，无论官民皆愿与之亲近交谈。' },
        { name: '勤勉不倦', description: '能承受繁重政务而不懈怠，是天生的优秀幕僚。' },
      ] as any,
      先天六司: { 精力: 8, 灵性: 9, 悟性: 7, 气运: 6, 魅力: 10, 心性: 7 },
      属性: {
        气血: { 当前: 1200, 上限: 1200 }, // 七品官员
        灵气: { 当前: 1500, 上限: 1500 },
        神识: { 当前: 1000, 上限: 1000 },
        寿元上限: 80 // 凡人寿命
      },
      与玩家关系: '陌生人',
      好感度: 0,
      当前位置: { 描述: playerLocationDesc || '县衙' },
      人格底线: ['不欺压百姓', '公正执法', '廉洁奉公'],
      记忆: [],
      当前外貌状态: '身着淡青色官袍，腰系青玉带，神色专注地审阅案卷。',
      当前内心想法: '（这些账目有些蹊跷…需要仔细核查。）',
      背包: {
        // 保留旧字段以兼容存档（灵石在县令主题中即银两/资金）
        灵石: { 下品: 100, 中品: 20, 上品: 5, 极品: 0 },
        货币: { 银两: { 币种: '银两', 名称: '银两', 数量: 500, 价值度: 1 } },
        物品: {}
      },
      实时关注: false,
      私密信息: {
        是否为处女: false,
        体液分泌状态: '正常',
        身体部位: [
          {
            部位名称: '双手',
            敏感度: 40,
            开发度: 30,
            特征描述: '修长白皙，指节分明，因常年握笔而指腹微有薄茧',
            反应描述: '书写时运笔如飞，从容不迫',
            偏好刺激: '整洁的文书和良笔',
            禁忌: '污损纸张',
          },
          {
            部位名称: '腰身',
            敏感度: 35,
            开发度: 25,
            特征描述: '因青玉带束腰而显得纤细挺拔，身姿端正',
            反应描述: '久坐后会轻微活动腰部舒缓',
            偏好刺激: '适当休息与活动',
            禁忌: '长时间保持一个姿势',
          },
          {
            部位名称: '眼部',
            敏感度: 50,
            开发度: 40,
            特征描述: '因长期阅读文案而略显疲惫，但目光依然锐利',
            反应描述: '审阅案卷时专注认真，发现问题时会眯眼细察',
            偏好刺激: '明亮光线与清晰字迹',
            禁忌: '昏暗环境下阅读',
          },
          {
            部位名称: '声音',
            敏感度: 60,
            开发度: 50,
            特征描述: '温润醇和，语速适中，善于安抚和说服',
          },
        ],
        性格倾向: '勤勉尽责型，温文尔雅，擅长协调各方',
        性取向: '未公开',
        性经验等级: '纯真',
        亲密节奏: '循序渐进，先建立信任再深入交流',
        亲密需求: '更在意尊重与理解',
        安全偏好: '保持适当距离，尊重个人界限',
        避孕措施: '暂无',
        性癖好: ['政务', '读书', '品茶', '抚琴'],
        亲密偏好: ['交谈', '共事', '品茗论道', '诗词唱和'],
        禁忌清单: ['权力滥用', '压迫', '公开羞辱'],
        性渴望程度: 10,
        当前性状态: '专注于政务，无暇他顾',
        性交总次数: 0,
        性伴侣名单: [],
        最近一次性行为时间: '无',
        生育状态: { 是否可孕: false, 当前状态: '不具备' },
        特殊体质: ['过目不忘', '精力充沛', '勤勉不倦', '心细如发'],
      },
      扩展: {
        specialNpc: true,
        specialNpcId: 'magistrate_administrative_assistant_cailian',
        specialNpcTags: ['earth', 'city', 'sect'],
      },
    }),
  },
];
