# 更新日志

## V4.5 正式版&网页版 (2026-01-25)

### 🎨 界面与主题

- **角色详情面板主题化重构**：将 CharacterDetailsPanel.vue 中的硬编码颜色值重构为 CSS 变量引用，支持全局主题切换
- **仙途主题调色板优化**：更新 xiantu 主题配色方案，调整主色调（灵韵青→天青蓝）、强调色、功能色等，提升视觉一致性
- **主题覆盖样式系统**：新增 theme-overrides.css（627行），统一全局主题样式

### ⚔️ 宗门战争系统

- **宗门战争模拟**：新增 sectWarSimulation.ts（345行），实现宗门战争模拟逻辑
- **宗门战争面板重构**：SectWarContent.vue 大幅扩展（+1254行），完善战争交互界面
- **宗门管理优化**：改进宗门成员、任务、贡献、藏经阁等子系统

### 🔧 核心修复

- **API兼容性增强**：修复多种API接口兼容问题，优化aiService.ts请求逻辑
- **提示词系统优化**：修复提示词错误，优化CoT思维链核心逻辑
- **数据定义完善**：改进dataDefinitions.ts，增强数据结构定义
- **JSON解析优化**：改进jsonExtract.ts，提升AI响应解析稳定性
- **世界生成器重构**：优化enhancedWorldGenerator.ts，改进世界生成流程

### ✨ 功能增强

- **存档面板改进**：优化SavePanel.vue，改进存档管理体验
- **三千大道面板优化**：改进ThousandDaoPanel.vue交互和显示
- **炼制面板精简**：优化CraftingPanel.vue代码结构
- **状态变化格式化**：改进stateChangeFormatter.ts，优化状态显示

### 🐛 Bug修复

- 修复人物数据相关问题
- 修复配置加载问题
- 修复命令验证器逻辑
- 修复数据修复模块问题

---

## V4.4.9 (2026-01-24)

### ⚔️ 宗门战争系统

- **宗门战争模拟**：新增 sectWarSimulation.ts（345行），实现宗门战争模拟逻辑
- **宗门战争面板重构**：SectWarContent.vue 大幅扩展（+1254行），完善战争交互界面
- **宗门管理优化**：改进 SectManagementContent.vue 宗门管理功能

### 🔧 修复

- 优化 aiService.ts 请求逻辑
- 改进 AIBidirectionalSystem.ts 双向通信
- 修复提示词和数据定义问题

---

## V4.4.8 (2026-01-23)

### 🔧 API兼容性修复

- **API服务优化**：修复多种API接口兼容问题，优化aiService.ts请求逻辑（+71行）
- **JSON解析优化**：改进jsonExtract.ts，提升AI响应解析稳定性
- **世界生成器重构**：优化enhancedWorldGenerator.ts，改进世界生成流程
- **双向通信精简**：优化AIBidirectionalSystem.ts代码结构

---

## V4.4.7 (2026-01-22)

### 🔧 修复

- **数据定义完善**：改进dataDefinitions.ts，增强数据结构定义

---

## V4.4.6 (2026-01-22)

### 🎨 界面与主题

- **角色详情面板重构**：CharacterDetailsPanel.vue 大规模重构（+2540行修改）
- **API管理面板优化**：改进APIManagementPanel.vue交互体验
- **主题覆盖样式系统**：新增 theme-overrides.css（627行），统一全局主题样式
- **设置面板优化**：改进SettingsPanel.vue

---

## V4.4.5 (2026-01-21)

### 🎨 界面优化

- **角色详情面板增强**：CharacterDetailsPanel.vue 大幅优化（+904行）
- **三千大道面板优化**：改进ThousandDaoPanel.vue交互和显示
- **宗门子系统优化**：改进宗门贡献、藏经阁、成员、任务等面板

### 🔧 核心修复

- **提示词系统优化**：优化CoT思维链核心逻辑和业务规则
- **双向通信改进**：优化AIBidirectionalSystem.ts
- **数据修复增强**：改进dataRepair.ts

---

## V4.4.3 (2026-01-21)

### 🔧 修复

- **提示词错误修复**：修复提示词系统多处错误
- **AI服务优化**：改进aiService.ts
- **三千大道面板修复**：修复ThousandDaoPanel.vue显示问题

---

## V4.4.2 (2026-01-20)

### 🎨 界面更新

- **游戏介绍页面重构**：大幅精简和优化游戏介绍.html
- **三千大道面板优化**：改进ThousandDaoPanel.vue

### 🔧 修复

- **提示词系统优化**：优化defaultPrompts.ts、cotCore.ts、businessRules.ts等
- **角色初始化优化**：改进characterInitializationPrompts.ts

---

## V4.4.1 (2026-01-20)

### 🔧 修复

- **存档面板改进**：优化SavePanel.vue，改进存档管理体验
- **提示词优化**：改进defaultPrompts.ts和coreRules.ts

---

## V4.4 正式版&网页版 (2026-01-20)

### 🔧 修复

- **主游戏面板优化**：改进MainGamePanel.vue交互逻辑
- **命令值验证修复**：修复commandValueValidator.ts验证问题

---

## V3.7.4 正式版&网页版 (2026-01-02)

### 🔧 关键修复

- **指令格式统一**：修复提示词中指令示例格式错误（旧格式 `action|key|value` → 正确JSON格式 `{"action":"...", "key":"...", "value":...}`），大幅减少AI生成格式错误
- **物品属性修改修复**：修复修改物品子属性时（如描述、使用效果）被误判为"物品必须是对象类型"的验证错误
- **功法生成修复**：优化功法物品的预处理和验证逻辑，确保功法技能数组正确生成

### ✨ 新功能

- **API测试功能**：新增API连接测试，可在配置后验证API可用性
- **分步提示词自定义**：支持自定义分步生成的提示词配置

---

## V3.7.0 正式版&网页版 (2026-01-01)

### 🧠 分步生成

- **开局/对话均支持分步生成**：第1步先出正文（可流式），第2步再出 `mid_term_memory` / `tavern_commands` / `action_options`（非流式，更快更稳）
- **分步提示词强化**：分步模式使用专用思维链格式，并补齐核心输出规则，减少 JSON 跑偏

---

## V3.6.7 正式版&网页版 (2026-01-01)

### 🧹 输出清理

- **自定义正则删标签**：新增可配置正则规则，对 AI 输出的显示文本做删除/清理（流式/非流式、网页版/酒馆版均生效），且不影响 AI JSON 解析

---

## V3.6.6 正式版&网页版 (2026-01-01)

### 🧩 关键修复

- **开局流式/非流式开关修复**：创角最终预览页可正确切换并生效
- **游戏内“流式传输”开关生效**：设置面板与实际对话流式开关统一
- **流式请求兼容增强**：自动识别不支持 SSE 的接口并降级为非流式，避免“开局生成失败”
- **上下文长度保护**：根据估算输入自动下调 `maxTokens`，输入过长给出明确报错提示
- **失败返回主页重新开始**：开局生成失败后可直接回到主页重开

---

## V3.6.5 正式版&网页版 (2025-12-29)

### 🎯 提示词与格式升级

- **启用新版输出格式**：强制 `"<thinking>...</thinking>" + ```json` 结构（text/mid_term_memory/tavern_commands，action_options按设置可选）
- **解析与校验更容错**：修复常见格式波动导致的“格式出错”（未闭合标签、全角分隔符、数字字符串/数组字段等）

### 🐛 Bug修复

- **人物关系丢失修复**：NPC条目缺少 `名字` 时不再被数据修复清理（用键名回填并保留展示）
- **关系/私密信息面板优化**：私密信息分组展示、长列表折叠，减少“看起来少/不显示”的误判

---

## V3.6.3 正式版&网页版 (2025-12-28)

### ✨ 体验优化

- **环境识别增强**：提升嵌入式环境检测稳定性（支持父/顶层窗口、延迟注入）
- **模式入口修复**：嵌入式环境下“联机共修”入口可用（仍保持原位置与命名）

### 🎯 系统优化

- **AI服务默认策略**：嵌入式环境强制使用内置接口，非嵌入环境默认自定义API
- **界面精简**：非嵌入环境隐藏嵌入式环境专属功能与相关字段（不影响嵌入模式）
- **设置面板回归**：恢复“行动选项”开关，避免误删与功能回退

### 🐛 Bug修复

- 修复无激活存档时，部分场景保存会重复弹出“没有激活的存档，无法保存！”
- 修复部分组件类型推断导致的 TS 报错（行动选项配置项）

---

## V3.6.2 正式版&网页版 (2025-11-28)

## 统一兑换码 `仙途`

## 网页端网址：https://www.ddct.top/

注意：记得切换为自定义API请求，请求路径删去后面的`/v1`

## 统一酒馆和网页版js文件路径，最新版请下载下面的角色卡，云更新也会更新到这张卡

## 多多点赞，你们的点赞是我更新的动力，我就不写多少多少赞更新了

### 🎨 界面全面升级

- **角色创建流程视觉重构**：全新深色玻璃拟态风格！
  - Step1 世界选择：重构布局和交互体验（+450行修改）
  - Step2 天资选择：优化卡片样式和动画效果（+279行修改）
  - Step3 出身选择：统一按钮样式，优化响应式布局（+287行修改）
  - Step4 灵根选择：改进组合选择模式UI（+210行修改）
  - Step5 天赋选择：统一顶部按钮风格（+188行修改）
  - Step6 属性分配：优化控件样式和交互（+172行修改）
  - Step7 最终预览：全新预览卡片设计（+331行修改）

- **角色管理面板增强**
  - 新增单个存档导出功能（每个存档旁边的导出按钮）
  - 统一存档导入/导出格式，移除冗余兼容代码
  - 修复导入存档时重复出现 `_1`后缀的问题

- **模式选择页面优化**
  - 新增深色玻璃拟态风格适配
  - 优化卡片悬停效果和过渡动画

### 🗺️ 地图系统优化

- **手机端双指缩放修复**
  - 修复移动端地图双指缩放失效问题
  - 优化触摸事件处理逻辑
  - 改进缩放中心点计算

### 🎯 系统优化

- **存档系统重构**
  - 统一存档导出格式：`{ type: 'saves', saves: [...] }`
  - 统一角色导出格式：`{ type: 'character', character: {...} }`
  - 简化导入逻辑，移除多格式兼容代码
  - 修复存档元数据与完整数据分离导致的问题

- **提示词系统精简**
  - 重构角色初始化提示词（-466行冗余代码）
  - 优化默认提示词结构

- **样式系统统一**
  - 统一所有Step组件的顶部按钮样式
  - 统一深色/亮色主题颜色变量
  - 优化滚动条样式一致性

### 🐛 Bug修复

- 修复存档导入时出现重复存档的问题
- 修复移动端地图缩放不响应的问题
- 修复角色创建步骤间样式不一致的问题
- 修复设置面板部分选项显示异常

---

## V3.6 正式版 (2025-11-28)

### 🎨 界面全面升级

- **角色创建流程视觉重构**：全新深色玻璃拟态风格！
  - Step1 世界选择：重构布局和交互体验（+450行修改）
  - Step2 天资选择：优化卡片样式和动画效果（+279行修改）
  - Step3 出身选择：统一按钮样式，优化响应式布局（+287行修改）
  - Step4 灵根选择：改进组合选择模式UI（+210行修改）
  - Step5 天赋选择：统一顶部按钮风格（+188行修改）
  - Step6 属性分配：优化控件样式和交互（+172行修改）
  - Step7 最终预览：全新预览卡片设计（+331行修改）

- **角色管理面板增强**
  - 新增单个存档导出功能（每个存档旁边的导出按钮）
  - 统一存档导入/导出格式，移除冗余兼容代码
  - 修复导入存档时重复出现`_1`后缀的问题

- **模式选择页面优化**
  - 新增深色玻璃拟态风格适配
  - 优化卡片悬停效果和过渡动画

### 🗺️ 地图系统优化

- **手机端双指缩放修复**
  - 修复移动端地图双指缩放失效问题
  - 优化触摸事件处理逻辑
  - 改进缩放中心点计算

### 🎯 系统优化

- **存档系统重构**
  - 统一存档导出格式：`{ type: 'saves', saves: [...] }`
  - 统一角色导出格式：`{ type: 'character', character: {...} }`
  - 简化导入逻辑，移除多格式兼容代码
  - 修复存档元数据与完整数据分离导致的问题

- **提示词系统精简**
  - 重构角色初始化提示词（-466行冗余代码）
  - 优化默认提示词结构

- **样式系统统一**
  - 统一所有Step组件的顶部按钮样式
  - 统一深色/亮色主题颜色变量
  - 优化滚动条样式一致性

### 🐛 Bug修复

- 修复存档导入时出现重复存档的问题
- 修复移动端地图缩放不响应的问题
- 修复角色创建步骤间样式不一致的问题
- 修复设置面板部分选项显示异常
- 修复角色创建页面视频背景被遮挡的问题

---

## V3.5 正式版 (2025-11-27)

### 🚀 重大更新

- **全新提示词管理系统**：玩家现可完全掌控AI行为！
  - 新增提示词管理面板（`PromptManagementPanel.vue`，620行）
  - 支持分类浏览：核心请求、总结请求、生成类、初始化提示词
  - 支持单项编辑、重置、导入/导出全部提示词
  - 实时标记修改状态，一键恢复默认
  - 完整的提示词存储服务（`promptStorage.ts`，181行）

- **自定义API支持**：摆脱酒馆限制，直连AI服务！
  - 新增统一AI服务层（`aiService.ts`，420行）
  - 支持酒馆模式（SillyTavern）和自定义API模式双切换
  - 自定义API支持OpenAI兼容格式，可配置：
    - API地址、密钥、模型选择
    - 温度参数（0-2）、最大Token数
    - 自动获取可用模型列表
  - 流式传输、记忆总结模式、开局生成模式均可配置

### ✨ 功能增强

- **设置面板全面升级**
  - 新增AI服务配置区块，集中管理所有AI相关设置
  - 文字大小改为滑块式调节（12-24px精确控制）
  - 新增酒馆连接状态检测
  - 界面更加直观易用

- **模式选择页面重构**
  - 全新视觉设计，更符合仙侠美学
  - 优化卡片布局和交互体验
  - 修复图标居中偏移问题

- **关系网络面板优化**
  - 改进NPC关系显示逻辑
  - 优化数据结构定义

### 🎯 系统优化

- **提示词引擎重构**
  - 新增默认提示词集合（`defaultPrompts.ts`，353行）
  - 优化CoT思维链核心逻辑
  - 精简冗余规则定义
  - 改进文本格式渲染

- **双向通信系统优化**
  - 重构`AIBidirectionalSystem.ts`（389行修改）
  - 提升AI响应稳定性和准确性

- **任务系统增强**
  - 优化任务存储和状态管理
  - 改进任务面板交互

### 🐛 Bug修复

- 修复模式选择页图标可能偏移的问题
- 修复记忆中心面板部分功能异常
- 修复存档面板数据同步问题
- 修复物品栏交互bug
- 修复云数据同步组件问题
- 修复角色初始化流程中的小问题

### 📝 其他

- 新增内置预设「炼气之神」3.81版本
- 优化国际化翻译支持
- 清理冗余代码和未使用的导入

---

## V3.2 正式版 (2025-11-11)

### 🚀 重大更新

- **重构全新地图系统**：朝天大陆游戏地图正式上线！
  - 新增 [`GameMapPanel.vue`](src/components/dashboard/GameMapPanel.vue) 游戏地图面板组件（914行新代码）
  - 新增 [`gameMapManager.ts`](src/utils/gameMapManager.ts) 地图管理器（1057行）
  - 新增 [`coordinateConverter.ts`](src/utils/coordinateConverter.ts) 坐标转换工具
  - 新增 [`gameMap.ts`](src/types/gameMap.ts) 地图类型定义
  - 支持地图缩放、拖拽、地点交互等功能
  - 精美的SVG图标（洞府/宗门/城镇/秘境）
  - 完整的地点信息展示和交互系统

### 🎯 系统优化

- **角色创建流程优化**
  - 优化世界选择界面（Step1）
  - 改进天赋档次选择逻辑（Step2）
  - 重构出生地选择界面（Step3，+167行）
  - 优化灵根选择流程（Step4，+55行）
  - 改进天赋选择界面（Step5，+58行）

- **提示词系统强化**
  - **任务系统开关控制**：新增 [`questSystemRules.ts`](src/utils/prompts/definitions/questSystemRules.ts)（92行）
  - **行动选项规范**：优化行动选项生成逻辑和数量控制
  - **CoT思维链**：改进核心思维链提示词（+41行修改）
  - **业务规则**：完善业务规则定义（+19行修改）
  - **角色初始化**：优化角色初始化提示词（+45行修改）
  - **世界生成**：重构世界生成提示词（+197行修改）

- **灵石系统修复**
  - 移除不合理的验证限制
  - 新增执行保护，防止灵石变成负数
  - 优化装备加成应用逻辑（+29行修改）

- **数据验证增强**
  - 改进指令验证器逻辑
  - 优化命令格式检查

### ✨ 功能增强

- **预设系统**：新增"【仙途】专用预设.json"（1072行）
- **路由优化**：改进路由配置
- **地点类型扩展**：完善地点类型定义（+42行）

### 🐛 Bug修复

- 修复灵石可能变成负数的问题
- 修复AI可能忽略行动选项数量要求的问题
- 修复任务系统关闭时仍可能生成任务的问题
- 修复角色创建流程中的多个bug
- 修复装备加成计算错误

### 📦 依赖更新

- 更新 package.json 和 package-lock.json
- 优化项目依赖配置

### 📝 文档完善

- 新增"地图系统重构计划.md"（679行）
- 更新游戏介绍页面

---

## V3.1.5 正式版 (2025-11-11)

### 🎯 核心优化

- **提示词系统重构**：大幅精简CoT思维链结构，优化业务规则和数据定义
- **游戏变量面板增强**：改进数据编辑和显示逻辑
- **物品系统优化**：完善物品栏交互和数据处理
- **主游戏面板改进**：优化游戏流程和用户体验

### 🐛 Bug修复

- 修复游戏变量面板数据同步问题
- 修复物品栏显示和操作相关bug
- 修复提示词结构导致的AI响应异常
- 修复数据定义和格式化相关问题
- 清理冗余预设文件

### 📝 文档更新

- 更新CHANGELOG记录所有版本变更

---

## V3.1 正式版 (2025-11-09)

### 🚀 核心更新

- **判定系统重构**：移除骰点，完全基于属性、境界和加成
- **记忆系统优化**：改进记忆总结流程和存储机制
- **预设系统增强**：优化预设保存和加载机制
- **思维链优化**：精简CoT提示词结构，提升AI响应效率
- **文本格式精简**：优化文本格式定义，提升渲染性能

### 🐛 Bug修复

- 修复判定逻辑错误
- 修复文本解析和渲染问题
- 修复预设加载失败问题
- 修复记忆总结数据污染

---

## V3.0.8 正式版 (2025-11-09)

- 精简CoT提示词结构，减少代码冗余
- 优化文本格式定义和FormattedText组件
- 修复文本解析和判定卡片显示问题

---

## V3.0 正式版 (2025-11-08)

### 🚀 核心更新

- **思维链系统**：引入CoT v3.0，简化思维链流程
- **判定系统**：完全基于属性、境界和加成，移除随机性
- **提示词优化**：新增600+行业务规则(境界压制/NPC人格/宏大概念约束/修炼细节等)
- **AI系统增强**：容错解析、流式传输、指令验证、记忆总结Raw模式

### ✨ 功能增强

- 关系网络面板重构，支持NPC记忆总结和关系可视化
- 记忆中心优化，支持导出小说格式
- 存档系统改进，增强验证和修复机制
- 游戏变量面板支持数据编辑
- FormattedText组件重构，新增判定规则帮助

### 🐛 Bug修复

- 修复指令执行导致的存档损坏
- 修复NPC数据结构、记忆总结污染、状态效果移除等问题
- 修复技能掌握度、时间推进、装备加成计算错误

---

## V2.8 正式版 (2025-10-29)

### 🚀 核心亮点：开放性与智能化

- **开放性预设导入/导出**：游戏从业界领先的单机体验，正式升级为**开放式社区创作平台**。玩家现在可以自由地分享、导入和导出包含世界观、文风、规则的完整游戏预设，开启无限可能的社区创作时代！
- **思维链内核 (CoT) 驱动**：重构了底层的提示词引擎，引入**思维链（Chain of Thought）**机制。AI的决策逻辑不再是简单的指令响应，而是模拟“思考”过程，使其行为更合理、更智能、更符合逻辑。
- **【仙途 3.0】预设实装**：游戏内容内核迎来“大版本”迭代，实装全新的 3.0 预设，带来更丰富的世界观、更完善的规则和更具沉浸感的叙事风格。

### ✨ 功能与体验增强

- **真·流式响应**：重构AI响应机制，实现真正的逐字流式输出，剧情生成如丝般顺滑，告别长时间等待。
- **指令安全验证系统**：引入强大的指令验证与修复模块，AI生成的所有指令在执行前都会经过严格校验，极大地提升了游戏稳定性，杜绝了因AI指令错误导致的存档损坏问题。
- **核心RPG系统增强**：
  - **记忆中心**：功能全面升级，玩家可更精细地管理角色记忆。
  - **关系网络**：功能增强，更直观地展示NPC间的复杂关系。
  - **判定系统优化**：判定更加规范和强大，完全基于角色实力。
- **行动队列优化**：优化了玩家连续指令的处理逻辑，响应更高效、更稳定。
- **任务系统**：增加任务删除按钮，管理更便捷。
- **开局流程**：删除了开局时无效的自定义选项，流程更顺畅。

### 🧹 项目维护

- **文档清理**：移除了过时的架构计划文档，标志着项目重构工作的圆满完成。

---

## V2.6.8 正式版 (2025-10-26)

- 修复开局出生种族选择
- 修复开局某些中转API生成失败
- 修复随机灵根、随机出生不被替换
- 修复状态效果不被移除
- 修复身体部位开发不显示描述
- 修复功法技能不解锁
- 修复NPC 私密资料几个显示错误
- 修复记忆转化问题
- 修复存档无法新建
- 增加记忆中心导出为小说模式
- 增加存档数据可以任意修改变量
- 优化任务系统，尊重用户选择，不强制做任务
- 优化提示词
- ...

---

## V2.6 正式版 (2025-10-26)

- 修复bug，优化游戏体验

---

## V2.5 正式版 (2025-10-24)

- 重构代码逻辑，抛弃酒馆变量
- 预设加载
- 任务系统
- 开局选项扩展
- 玩家NSFW信息

---

## V2.0 Beta (2025-10-15)

- 修复物品丢弃失败等bug...
- 优化提示词结构、强化JSON结构生成
- 其他...

---

## V1.9 Beta (2025-10-13)

- 修复已知bug
- 优化提示词结构、强化JSON结构生成
- 其他...

---

## V1.8 Beta (2025-10-10)

- 修复bug
- 优化提示词结构
- 增加适配预设

---

## V1.6 Beta (2025-10-09)

- 修复所有已知bug
- 增加角色管理页面导入存档

---

## V1.5 Beta (2025-10-08)

- 修复已知所有bug，增强命令提示词
- 增加重Roll、人物18+模块
- 将本地localstore存储改为浏览器IndexedDB，加快速度，存储空间

---

## V1.0 Beta (2025-10-04)

- 完整的角色创建系统
- 智能判定系统（含境界、装备、大道、功法加成）
- 自动存档+上次对话备份
- 三千大道系统
- 动态剧情生成
- 格式化文本渲染（环境、心理、对话、判定卡片）

---

## V0.1 Alpha (2025-09-18)

- 完善基础框架
- 初始化选择界面
- 各种数据类型格式
- UI设计
- 游戏主体搭建
